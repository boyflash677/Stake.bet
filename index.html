"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 LoliPop Store â€“ Single-file Server
 (Flask + Telegram bot + HTML + CSS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Run:  pip install python-telegram-bot==20.1 Flask==3.0.3
      python app.py        # localhost:8000
Deploy: Render / Railway / Termux + ngrok
"""

import os, json
from flask import Flask, request, jsonify, Response, send_from_directory
from telegram import Bot, ParseMode

# â”€â”€â”€ ENV VARS (safer) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOKEN   = os.getenv("TOKEN",   "7965746766:AAHTCgZJteje4WvRn4Rxr0aapzg7wmvujG0")
CHAT_ID = int(os.getenv("CHAT_ID", "1972373864"))
bot = Bot(TOKEN)

app = Flask(__name__)

# â”€â”€â”€ HTML  (10 placeholder products) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTML_PAGE = r"""
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LoliPop Store</title>
<style>
:root { --accent:#ff5dad; --dark:#111; --light:#fff; --shadow:0 4px 16px rgba(0,0,0,.08);}
*{box-sizing:border-box;scroll-behavior:smooth}
body{margin:0;font-family:system-ui;background:var(--light);color:var(--dark);}
.hero{padding:3.5rem 1rem;text-align:center;background:linear-gradient(135deg,#ff5dad 0%,#ffe1f5 100%);}
.hero h1{font-size:2.6rem;margin:0;font-weight:900;letter-spacing:.03em;}
.hero p{margin-top:.3rem;font-size:1.05rem;}
.container{padding:2rem 1rem;max-width:960px;margin:auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));grid-gap:1.7rem;}
.card{border:2px solid var(--accent);border-radius:1rem;overflow:hidden;box-shadow:var(--shadow);background:#fff;display:flex;flex-direction:column;}
.card img{width:100%;height:auto;display:block;}
.info{padding:1rem;flex:1 1 auto;display:flex;flex-direction:column;}
.info h2{font-size:1.25rem;margin:.3rem 0 .6rem;}
.price{margin-bottom:1rem;font-size:1.1rem;}
.price del{color:#777;margin-right:.4rem;}
.btn{align-self:flex-start;background:var(--accent);color:var(--light);padding:.55rem 1.2rem;font-weight:700;border:none;border-radius:.6rem;text-decoration:none;cursor:pointer;}
footer{text-align:center;padding:1.2rem 0;color:#666;border-top:1px solid #eee;font-size:.9rem;}
/* modal */
#orderModal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:1000;}
#orderModal form{background:#fff;padding:2rem;border-radius:1rem;max-width:420px;width:90%;box-shadow:var(--shadow);}
#orderModal h3{margin-top:0;font-size:1.4rem;}
#orderModal input,#orderModal textarea{width:100%;padding:.65rem;margin:.4rem 0;border:1px solid #ccc;border-radius:.4rem;font-size:.95rem;}
#orderModal button{width:100%;margin-top:.6rem;}
@media (prefers-color-scheme:dark){
  body{background:#111;color:#eee;}
  .hero{background:linear-gradient(135deg,#ff5dad 0%,#44112c 100%);}
  .card{background:#1a1a1a;border-color:#ff5dad;}
  .info h2{color:#fff;}
}
</style>
</head><body>

<section class="hero">
  <h1>LoliPop Store</h1>
  <p>Cash-on-Delivery â€¢ Free Shipping â€¢ Limited Stock</p>
</section>

<main class="container" id="products">
<!-- ===== 10 Placeholder Products ===== -->
{products_html}
</main>

<footer>Â© 2025 LoliPop Store â€¢ Powered by Python</footer>

<!-- ===== Order Modal ===== -->
<div id="orderModal">
  <form id="orderForm">
    <h3 id="modalTitle">Order</h3>
    <input type="hidden" id="prodName">
    <input type="hidden" id="prodPrice">
    <label>Full Name*<input required id="custName" placeholder="Rahul Mehra"></label>
    <label>Phone*<input required id="custPhone" placeholder="9876543210"></label>
    <label>Address*<textarea required id="custAddr" rows="3" placeholder="123 MG Road, Mumbai â€“ 400001"></textarea></label>
    <label>Quantity*<input type="number" min="1" value="1" id="custQty"></label>
    <button class="btn" type="submit">Place Order</button>
  </form>
</div>

<script>
// modal open
document.querySelectorAll(".btn").forEach(btn=>{
  btn.onclick=e=>{
    const card=e.target.closest(".card");
    document.getElementById("prodName").value=card.dataset.name;
    document.getElementById("prodPrice").value=card.dataset.price;
    document.getElementById("modalTitle").innerText=`Order â€“ ${card.dataset.name}`;
    document.getElementById("orderModal").style.display="flex";
  };
});
// modal close when bg clicked
document.getElementById("orderModal").onclick=e=>{
  if(e.target.id==="orderModal")e.target.style.display="none";
};
// send order
document.getElementById("orderForm").onsubmit=async e=>{
  e.preventDefault();
  const data={
    product :document.getElementById("prodName").value,
    price   :document.getElementById("prodPrice").value,
    name    :document.getElementById("custName").value,
    phone   :document.getElementById("custPhone").value,
    address :document.getElementById("custAddr").value,
    qty     :document.getElementById("custQty").value
  };
  try{
    const r=await fetch("/order",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    const res=await r.json();
    if(res.ok){
      alert("Order placed! Confirmation sent on Telegram.");
      document.getElementById("orderModal").style.display="none";
      e.target.reset();
    }else throw 0;
  }catch{ alert("Error, try again."); }
};
</script>
</body></html>
"""

# â”€â”€â”€ Build placeholder product HTML  (edit later) â”€â”€â”€â”€â”€
PRODUCT_CARD = """
<div class="card" data-name="Sample Product {i}" data-price="â‚¹499">
  <img src="https://via.placeholder.com/640x640.png?text=Product+{i}" alt="Product {i}">
  <div class="info">
    <h2>Sample Product {i}</h2>
    <p class="price"><del>â‚¹999</del> <span>â‚¹499</span></p>
    <button class="btn">Order Now</button>
  </div>
</div>
"""
products_html = "\n".join(PRODUCT_CARD.format(i=i) for i in range(1,11))
FULL_PAGE = HTML_PAGE.format(products_html=products_html)

# â”€â”€â”€ Routes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@app.route("/")
def home():
    return Response(FULL_PAGE, mimetype="text/html")

@app.route("/order", methods=["POST"])
def receive_order():
    data = request.json or {}
    for k in ("product","price","name","phone","address","qty"):
        if not data.get(k): return jsonify(ok=False,error="missing"),400
    msg = (
        "ğŸ“¦ *New Order â€“ LoliPop Store*\n\n"
        f"ğŸ‘• *Product:* {data['product']}\n"
        f"ğŸ’° *Price:* {data['price']}\n"
        f"ğŸ™ *Name:* {data['name']}\n"
        f"ğŸ“ *Phone:* {data['phone']}\n"
        f"ğŸ  *Address:* {data['address']}\n"
        f"ğŸ“¦ *Qty:* {data['qty']}"
    )
    bot.send_message(chat_id=CHAT_ID, text=msg, parse_mode=ParseMode.MARKDOWN)
    return jsonify(ok=True)

# â”€â”€â”€ Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000, debug=False)
